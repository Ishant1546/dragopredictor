<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --primary-green: #10b981;
            --dark-green: #059669;
            --light-green: #d1fae5;
            --background-white: #ffffff;
            --card-white: #ffffff;
            --border-color: #e5e7eb;
            --text-dark: #111827;
            --text-gray: #6b7280;
            --text-light: #9ca3af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Inter', sans-serif; 
            user-select: none; 
        }
        
        body { 
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Landing Page */
        #landing-page { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            padding: 40px 20px;
            text-align: center;
        }
        
        .landing-header {
            margin-bottom: 50px;
        }
        
        .main-title {
            font-size: 48px;
            font-weight: 700;
            color: var(--dark-green);
            margin-bottom: 15px;
            line-height: 1.2;
        }
        
        .main-subtitle {
            font-size: 18px;
            color: var(--text-gray);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .platforms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            width: 100%;
            max-width: 1200px;
            margin-top: 30px;
        }
        
        .platform-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .platform-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-green);
            box-shadow: var(--shadow-lg);
        }
        
        .platform-icon {
            width: 70px;
            height: 70px;
            background: var(--light-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--dark-green);
            margin-bottom: 10px;
        }
        
        .platform-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .platform-desc {
            font-size: 14px;
            color: var(--text-gray);
            line-height: 1.5;
        }
        
        .platform-status {
            margin-top: auto;
            font-size: 12px;
            padding: 5px 12px;
            border-radius: 20px;
            background: var(--light-green);
            color: var(--dark-green);
            font-weight: 500;
        }
        
        /* Key Page */
        #key-page { 
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            padding: 40px 20px;
        }
        
        .auth-container {
            width: 100%;
            max-width: 450px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .auth-header {
            margin-bottom: 30px;
        }
        
        .auth-header h2 {
            font-size: 28px;
            color: var(--dark-green);
            margin-bottom: 10px;
        }
        
        .auth-header p {
            color: var(--text-gray);
            font-size: 15px;
        }
        
        .key-input-group {
            margin-bottom: 25px;
        }
        
        .key-input {
            width: 100%;
            padding: 16px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-dark);
            font-size: 16px;
            font-family: 'Roboto Mono', monospace;
            letter-spacing: 1px;
            text-align: center;
            transition: all 0.2s;
        }
        
        .key-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .verify-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .verify-btn:hover {
            background: var(--dark-green);
            transform: translateY(-1px);
        }
        
        .auth-error {
            background: #fee2e2;
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            font-size: 14px;
            text-align: center;
        }
        
        .security-info {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 13px;
            color: var(--text-gray);
        }
        
        /* Prediction Page */
        #prediction-page { 
            display: none; 
            min-height: 100vh; 
            padding: 20px;
        }
        
        .app-wrapper {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .platform-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-badge {
            background: white;
            color: var(--dark-green);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .app-content {
            padding: 30px;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--light-green);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid #a7f3d0;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--dark-green);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-gray);
        }
        
        .prediction-section {
            margin: 30px 0;
            padding: 30px;
            background: linear-gradient(135deg, #f8fafc 0%, #f0fdf4 100%);
            border-radius: 20px;
            border: 2px solid var(--border-color);
            text-align: center;
        }
        
        .period-display {
            font-size: 16px;
            color: var(--text-gray);
            margin-bottom: 20px;
        }
        
        .period-value {
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            color: var(--dark-green);
            font-size: 20px;
        }
        
        .prediction-main {
            margin: 30px 0;
        }
        
        .prediction-value {
            font-size: 72px;
            font-weight: 900;
            color: var(--dark-green);
            margin: 20px 0;
            font-family: 'Inter', sans-serif;
        }
        
        .prediction-type {
            font-size: 18px;
            color: var(--text-gray);
            margin-bottom: 10px;
        }
        
        .confidence-meter {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 6px;
            margin: 30px auto;
            max-width: 400px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1s ease-in-out;
            background: linear-gradient(90deg, var(--primary-green), var(--dark-green));
        }
        
        .confidence-text {
            font-size: 14px;
            color: var(--text-gray);
            margin-top: 10px;
        }
        
        .algorithm-status {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            margin: 30px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .algo-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .algo-icon {
            width: 40px;
            height: 40px;
            background: var(--light-green);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-green);
            font-size: 20px;
        }
        
        .algo-info h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .algo-info p {
            font-size: 14px;
            color: var(--text-gray);
        }
        
        .algo-confidence {
            font-weight: 700;
            color: var(--dark-green);
            font-size: 24px;
        }
        
        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--border-color);
            margin: 30px 0;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-green);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .toggle-btn {
            background: var(--light-green);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--dark-green);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .toggle-btn:hover {
            background: var(--primary-green);
            color: white;
        }
        
        .analysis-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .analysis-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        
        .analysis-label {
            font-size: 14px;
            color: var(--text-gray);
            margin-bottom: 8px;
        }
        
        .analysis-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark-green);
        }
        
        .pattern-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .pattern-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            font-family: 'Roboto Mono', monospace;
            font-weight: 700;
            font-size: 18px;
            color: var(--text-dark);
            transition: all 0.2s;
        }
        
        .pattern-item.big {
            background: var(--light-green);
            color: var(--dark-green);
            border-color: var(--primary-green);
        }
        
        .pattern-item.small {
            background: #e0f2fe;
            color: var(--info);
            border-color: var(--info);
        }
        
        .history-section {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .history-item:hover {
            background: #f9fafb;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-period {
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .history-prediction {
            font-weight: 700;
            font-size: 18px;
        }
        
        .history-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-win {
            background: var(--light-green);
            color: var(--dark-green);
        }
        
        .status-loss {
            background: #fee2e2;
            color: var(--danger);
        }
        
        .status-pending {
            background: #fef3c7;
            color: var(--warning);
        }
        
        /* Navigation */
        .nav-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-green);
            font-size: 20px;
            z-index: 100;
            transition: all 0.2s;
        }
        
        .nav-button:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }
        
        /* Key Timer */
        .key-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: var(--shadow-md);
            font-weight: 600;
            color: var(--dark-green);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            display: none;
        }
        
        /* Admin Panel */
        #admin-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .admin-header h3 {
            font-size: 24px;
            color: var(--dark-green);
            margin-bottom: 10px;
        }
        
        .admin-input {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-dark);
            font-size: 15px;
        }
        
        .admin-input:focus {
            outline: none;
            border-color: var(--primary-green);
        }
        
        .admin-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            margin: 10px 0;
            transition: all 0.2s;
        }
        
        .admin-btn:hover {
            background: var(--dark-green);
        }
        
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--light-green);
            border-radius: 50%;
            border-top-color: var(--primary-green);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-gray);
            transition: all 0.2s;
        }
        
        .page-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }
        
        .page-btn:hover:not(.active) {
            border-color: var(--primary-green);
            color: var(--primary-green);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-title {
                font-size: 36px;
            }
            
            .platforms-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .prediction-value {
                font-size: 48px;
            }
            
            .algorithm-status {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .analysis-content {
                grid-template-columns: 1fr;
            }
            
            .nav-button {
                top: 15px;
                left: 15px;
            }
            
            .key-timer {
                top: 15px;
                right: 15px;
            }
            
            .pagination {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Overlay for modals -->
    <div id="overlay"></div>
    
    <!-- Admin Panel -->
    <div id="admin-panel">
        <div class="admin-header">
            <h3>Admin Key Generator</h3>
            <p style="color: var(--text-gray); font-size: 14px;">Generate access keys for users</p>
        </div>
        <input type="password" id="admin-pass" class="admin-input" placeholder="Enter Admin Password">
        <div id="admin-controls" style="display:none;">
            <select id="time-unit" class="admin-input">
                <option value="minutes">Minutes</option>
                <option value="hours">Hours</option>
                <option value="days" selected>Days</option>
                <option value="months">Months</option>
            </select>
            <input type="number" id="time-value" class="admin-input" placeholder="Time Value (e.g., 24)" min="1" max="365">
            <input type="number" id="device-limit" class="admin-input" placeholder="Device Limit (e.g., 1)" min="1" max="10">
            <button class="admin-btn" onclick="generateKey()">Generate Key</button>
            <div id="generated-key" style="margin-top: 20px; padding: 15px; background: var(--light-green); border-radius: 10px; display: none;"></div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                <h4 style="color: var(--dark-green); margin-bottom: 15px;">Active Keys</h4>
                <div id="active-keys" style="max-height: 200px; overflow-y: auto;"></div>
            </div>
            
            <button class="admin-btn" onclick="closeAdminPanel()" style="background: var(--danger); margin-top: 20px;">Close Panel</button>
        </div>
    </div>
    
    <!-- Navigation Button -->
    <button class="nav-button" id="nav-back" style="display: none;" onclick="goBack()">
        <i class="fas fa-arrow-left"></i>
    </button>
    
    <!-- Key Timer -->
    <div class="key-timer" id="key-countdown">
        <i class="fas fa-clock"></i>
        <span>Loading...</span>
    </div>
    
    <!-- Landing Page -->
    <section id="landing-page">
        <div class="landing-header">
            <h1 class="main-title">Pro Prediction Platform</h1>
            <p class="main-subtitle">Advanced algorithmic predictions for gaming platforms. Select your platform to continue.</p>
        </div>
        
        <div class="platforms-grid">
            <div class="platform-card" onclick="openKeyPage('TASHAN')">
                <div class="platform-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="platform-name">TASHAN</div>
                <div class="platform-desc">Real-time predictions with high accuracy rates</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('DM WIN')">
                <div class="platform-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="platform-name">DM WIN</div>
                <div class="platform-desc">Advanced algorithm for consistent results</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('DAMAN')">
                <div class="platform-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="platform-name">DAMAN</div>
                <div class="platform-desc">Fast predictions with live updates</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('JALWA')">
                <div class="platform-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="platform-name">JALWA</div>
                <div class="platform-desc">Hot streak detection and analysis</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('82 LOTTERY')">
                <div class="platform-icon">
                    <i class="fas fa-dice"></i>
                </div>
                <div class="platform-name">82 LOTTERY</div>
                <div class="platform-desc">Lottery prediction algorithms</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('BDG GAME')">
                <div class="platform-icon">
                    <i class="fas fa-gamepad"></i>
                </div>
                <div class="platform-name">BDG GAME</div>
                <div class="platform-desc">Game-specific pattern analysis</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('GOA GAME')">
                <div class="platform-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="platform-name">GOA GAME</div>
                <div class="platform-desc">Premium prediction service</div>
                <div class="platform-status">Active</div>
            </div>
            
            <div class="platform-card" onclick="openKeyPage('91 CLUB')">
                <div class="platform-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="platform-name">91 CLUB</div>
                <div class="platform-desc">Community-based predictions</div>
                <div class="platform-status">Active</div>
            </div>
        </div>
        
        <div style="margin-top: 40px; font-size: 14px; color: var(--text-light);">
            <i class="fas fa-shield-alt"></i> Secured Access Required • <i class="fas fa-sync-alt"></i> Real-time Updates
        </div>
    </section>
    
    <!-- Key Authentication Page -->
    <section id="key-page">
        <div class="auth-container">
            <div class="auth-header">
                <h2>Access Verification</h2>
                <p>Enter your access key to continue to the predictor</p>
            </div>
            
            <div class="key-input-group">
                <input type="password" id="key-input" class="key-input" placeholder="Enter Access Key (e.g., MICK-ABC123-XYZ789)">
            </div>
            
            <button class="verify-btn" onclick="verifyKey()">
                <i class="fas fa-unlock"></i> Verify & Continue
            </button>
            
            <div class="auth-error" id="error-msg">
                <i class="fas fa-exclamation-circle"></i> Invalid or expired access key!
            </div>
            
            <div class="security-info">
                <i class="fas fa-info-circle"></i> Your key is encrypted and verified against our secure database
            </div>
        </div>
    </section>
    
    <!-- Prediction Page -->
    <section id="prediction-page">
        <div class="app-wrapper">
            <div class="app-header">
                <div class="header-left">
                    <div class="app-logo">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div>
                        <div class="app-title">Pro Predictor</div>
                        <div class="app-subtitle">Algorithmic Prediction System</div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="platform-badge" id="selected-platform">...</div>
                    <div class="status-badge" id="analysis-status">
                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                        <span>Ready</span>
                    </div>
                </div>
            </div>
            
            <div class="app-content">
                <!-- Stats Row -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="streak-wins">0</div>
                        <div class="stat-label">Total Wins</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="streak-losses">0</div>
                        <div class="stat-label">Total Losses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy-rate">0%</div>
                        <div class="stat-label">All Time Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-predictions">0</div>
                        <div class="stat-label">Total Predictions</div>
                    </div>
                </div>
                
                <!-- Current Period -->
                <div class="period-display">
                    Current Period: <span class="period-value" id="current-period">Loading...</span>
                </div>
                
                <!-- Main Prediction -->
                <div class="prediction-section">
                    <div class="prediction-type" id="prediction-type">Next Prediction</div>
                    <div class="prediction-value" id="prediction-text">--</div>
                    <div class="confidence-meter">
                        <div id="confidence-fill" class="confidence-fill" style="width: 0%;"></div>
                    </div>
                    <div class="confidence-text">
                        Confidence: <span id="confidence-display">0%</span>
                    </div>
                </div>
                
                <!-- Algorithm Status -->
                <div class="algorithm-status">
                    <div class="algo-left">
                        <div class="algo-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="algo-info">
                            <h4 id="algo-name">Analyzing Patterns</h4>
                            <p id="algo-status">Collecting data for analysis...</p>
                        </div>
                    </div>
                    <div class="algo-confidence" id="algo-confidence">0%</div>
                </div>
                
                <!-- Analysis Section -->
                <div class="analysis-section">
                    <div class="section-title">
                        <span>Pattern Analysis</span>
                        <button class="toggle-btn" onclick="toggleAnalysis()">
                            <i class="fas fa-eye"></i>
                            <span>Show Analysis</span>
                        </button>
                    </div>
                    
                    <div id="analysis-content" style="display: none;">
                        <div class="analysis-content">
                            <div class="analysis-item">
                                <div class="analysis-label">BIG %</div>
                                <div class="analysis-value" id="big-percent">0%</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">SMALL %</div>
                                <div class="analysis-value" id="small-percent">0%</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">RED %</div>
                                <div class="analysis-value" id="red-percent">0%</div>
                            </div>
                            <div class="analysis-item">
                                <div class="analysis-label">GREEN %</div>
                                <div class="analysis-value" id="green-percent">0%</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <div style="font-size: 14px; color: var(--text-gray); margin-bottom: 10px;">Recent Pattern (Last 10)</div>
                            <div class="pattern-display" id="pattern-display">
                                <!-- Pattern items loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Prediction History -->
                <div class="analysis-section">
                    <div class="section-title">
                        <span>Prediction History</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <select id="history-filter" class="select-field" style="width: auto; padding: 6px 12px; font-size: 14px;" onchange="loadHistoryFromFirebase()">
                                <option value="all">All Predictions</option>
                                <option value="win">Wins Only</option>
                                <option value="loss">Losses Only</option>
                                <option value="pending">Pending Only</option>
                            </select>
                            <span style="font-size: 14px; color: var(--text-gray);">Page <span id="current-page">1</span> of <span id="total-pages">1</span></span>
                        </div>
                    </div>
                    <div class="history-section" id="history-list">
                        <!-- History items loaded from Firebase -->
                    </div>
                    <div class="pagination" id="pagination-controls">
                        <!-- Pagination buttons loaded here -->
                    </div>
                </div>
                
                <!-- Footer -->
        <div class="footer" style="margin-top: 40px; font-size: 14px; color: var(--text-light);">
            <i class="fas fa-shield-alt"></i> 2026 Mr. Man • Predictor System
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Hidden Admin Button -->
    <div id="admin-btn" style="position: fixed; bottom: 20px; right: 20px; width: 1px; height: 1px; opacity: 0;"></div>
    
    <script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAAYvg76xHVxBD60YC11jrvjQ9hPOG2dQA",
        authDomain: "tokyo-b6323.firebaseapp.com",
        databaseURL: "https://tokyo-b6323-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "tokyo-b6323",
        storageBucket: "tokyo-b6323.firebasestorage.app",
        messagingSenderId: "262852364158",
        appId: "1:262852364158:web:074184567c9abc980b952f",
        measurementId: "G-THXFN640VX"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const API_URL = "https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json";
    let lastPeriod = "";
    let historyData = [];
    let winStreak = 0;
    let lossStreak = 0;
    let totalPredictions = 0;
    let correctPredictions = 0;
    let algorithmPatterns = [];
    let currentAlgorithm = null;
    let last10Results = [];
    let isAnalyzing = false;
    let analysisComplete = false;
    let realPrediction = null;
    let currentKeyData = null;
    let countdownInterval = null;
    let currentDeviceId = null;
    let selectedPlatform = '';
    let currentHistoryPage = 1;
    const HISTORY_PAGE_SIZE = 10;
    let totalHistoryPages = 1;
    let allFirebasePredictions = [];

    // Generate unique device ID
    function generateDeviceId() {
        let deviceId = localStorage.getItem('pro_device_id');
        if (!deviceId) {
            deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('pro_device_id', deviceId);
        }
        return deviceId;
    }

    // Initialize device ID
    currentDeviceId = generateDeviceId();

    // Admin panel functionality
    document.getElementById('admin-btn').addEventListener('click', function(e) {
        const rect = this.getBoundingClientRect();
        if (rect.width === 1 && rect.height === 1) {
            const password = prompt("Enter Admin Password:");
            if (password === "456") {
                document.getElementById('overlay').style.display = 'block';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-controls').style.display = 'block';
                loadActiveKeys();
            }
        }
    });

    function closeAdminPanel() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'none';
        document.getElementById('admin-pass').value = '';
    }

    function generateKey() {
        const timeUnit = document.getElementById('time-unit').value;
        const timeValue = parseInt(document.getElementById('time-value').value);
        const deviceLimit = parseInt(document.getElementById('device-limit').value);
        
        if (!timeValue || timeValue < 1 || !deviceLimit || deviceLimit < 1) {
            alert('Please enter valid values');
            return;
        }
        
        // Generate random key
        const key = 'PRO' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 6).toUpperCase();
        
        // Calculate expiration time
        let expiresAt = Date.now();
        switch(timeUnit) {
            case 'minutes':
                expiresAt += timeValue * 60 * 1000;
                break;
            case 'hours':
                expiresAt += timeValue * 60 * 60 * 1000;
                break;
            case 'days':
                expiresAt += timeValue * 24 * 60 * 60 * 1000;
                break;
            case 'months':
                expiresAt += timeValue * 30 * 24 * 60 * 60 * 1000;
                break;
        }
        
        // Save to Firebase
        const keyData = {
            key: key,
            createdAt: Date.now(),
            expiresAt: expiresAt,
            deviceLimit: deviceLimit,
            devices: {},
            isActive: true
        };
        
        database.ref('keys/' + key).set(keyData)
            .then(() => {
                document.getElementById('generated-key').innerHTML = 
                    `<strong>Generated Key:</strong><br>${key}<br><br>
                     <small>Expires in: ${timeValue} ${timeUnit}<br>
                     Device Limit: ${deviceLimit}</small>`;
                document.getElementById('generated-key').style.display = 'block';
                loadActiveKeys();
            })
            .catch(error => {
                console.error('Error saving key:', error);
                alert('Error generating key');
            });
    }
	
	function updateLocalStats() {
    // Agar Firebase fail ho jaye to local stats use karenge
    const localTotal = winStreak + lossStreak; // Ab winStreak aur lossStreak me count hai
    const localAccuracy = localTotal > 0 ? Math.round((winStreak / localTotal) * 100) : 0;
    
    document.getElementById('streak-wins').textContent = winStreak;
    document.getElementById('streak-losses').textContent = lossStreak;
    document.getElementById('accuracy-rate').textContent = localAccuracy + '%';
    document.getElementById('total-predictions').textContent = localTotal;
}
	
async function updateStatsFromFirebase() {
    try {
        const snapshot = await database.ref('predictions').once('value');
        const predictions = snapshot.val();
        
        if (!predictions) {
            // Agar koi prediction nahi hai to default values
            document.getElementById('streak-wins').textContent = '0';
            document.getElementById('streak-losses').textContent = '0';
            document.getElementById('accuracy-rate').textContent = '0%';
            document.getElementById('total-predictions').textContent = '0';
            return;
        }
        
        let allPredictions = Object.values(predictions);
        
        // Total win aur loss count karenge (streak nahi)
        let winCount = 0;
        let lossCount = 0;
        let totalCount = 0;
        
        allPredictions.forEach(pred => {
            if (pred.status === 'WIN') {
                winCount++;
                totalCount++;
            } else if (pred.status === 'LOSS') {
                lossCount++;
                totalCount++;
            }
        });
        
        // Accuracy calculate karenge
        let accuracy = 0;
        if (totalCount > 0) {
            accuracy = Math.round((winCount / totalCount) * 100);
        }
        
        // UI update karenge - WIN COUNT aur LOSS COUNT show karenge
        document.getElementById('streak-wins').textContent = winCount;
        document.getElementById('streak-losses').textContent = lossCount;
        document.getElementById('accuracy-rate').textContent = accuracy + '%';
        document.getElementById('total-predictions').textContent = totalCount;
        
        // Global variables bhi update karenge
        winStreak = winCount; // Ab ye win count hai, streak nahi
        lossStreak = lossCount; // Ab ye loss count hai, streak nahi
        totalPredictions = totalCount;
        correctPredictions = winCount;
        
        // Console me debug ke liye
        console.log('Firebase Stats:', {
            winCount: winCount,
            lossCount: lossCount,
            totalCount: totalCount,
            accuracy: accuracy + '%'
        });
        
    } catch (error) {
        console.error('Error updating stats from Firebase:', error);
        // Fallback to local stats
        updateLocalStats();
    }
}

    function loadActiveKeys() {
        database.ref('keys').once('value')
            .then(snapshot => {
                const keys = snapshot.val();
                const keysList = document.getElementById('active-keys');
                keysList.innerHTML = '';
                
                if (!keys) {
                    keysList.innerHTML = '<div style="color: var(--text-gray); text-align: center; padding: 20px;">No active keys</div>';
                    return;
                }
                
                Object.keys(keys).forEach(keyId => {
                    const key = keys[keyId];
                    const isExpired = Date.now() > key.expiresAt;
                    const deviceCount = key.devices ? Object.keys(key.devices).length : 0;
                    
                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key-item';
                    keyDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 10px; border-bottom: 1px solid var(--border-color);">
                            <div>
                                <strong>${key.key.substring(0, 12)}...</strong><br>
                                <small>Devices: ${deviceCount}/${key.deviceLimit}</small>
                            </div>
                            <div style="text-align: right;">
                                <span style="color: ${isExpired ? 'var(--danger)' : 'var(--success)'}">
                                    ${isExpired ? 'EXPIRED' : 'ACTIVE'}
                                </span><br>
                                <small>${formatTimeRemaining(key.expiresAt - Date.now())}</small>
                            </div>
                        </div>
                    `;
                    keysList.appendChild(keyDiv);
                });
            });
    }

    function formatTimeRemaining(ms) {
        if (ms <= 0) return 'Expired';
        
        const days = Math.floor(ms / (1000 * 60 * 60 * 24));
        const hours = Math.floor((ms % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
        
        if (days > 0) return `${days}d ${hours}h`;
        if (hours > 0) return `${hours}h ${minutes}m`;
        return `${minutes}m`;
    }

    function updateCountdown() {
        if (!currentKeyData) return;
        
        const remaining = currentKeyData.expiresAt - Date.now();
        if (remaining <= 0) {
            document.getElementById('key-countdown').innerHTML = '<i class="fas fa-clock"></i> <span style="color: var(--danger);">KEY EXPIRED</span>';
            
            // Auto-logout when key expires
            setTimeout(() => {
                alert('Your key has expired! Please contact support for a new key.');
                localStorage.removeItem('pro_active_key');
                localStorage.removeItem('pro_key_data');
                document.getElementById('prediction-page').style.display = 'none';
                document.getElementById('landing-page').style.display = 'flex';
                document.getElementById('nav-back').style.display = 'none';
                document.getElementById('key-countdown').style.display = 'none';
            }, 1000);
            return;
        }
        
        document.getElementById('key-countdown').innerHTML = 
            `<i class="fas fa-clock"></i> <span style="color: ${remaining < 3600000 ? 'var(--warning)' : 'var(--success)'}">${formatTimeRemaining(remaining)}</span>`;
    }

    function startCountdown() {
        if (countdownInterval) clearInterval(countdownInterval);
        countdownInterval = setInterval(updateCountdown, 1000);
        updateCountdown();
        document.getElementById('key-countdown').style.display = 'flex';
        document.getElementById('nav-back').style.display = 'flex';
    }

    function stopCountdown() {
        if (countdownInterval) clearInterval(countdownInterval);
        document.getElementById('key-countdown').style.display = 'none';
        document.getElementById('nav-back').style.display = 'none';
    }

// Window onload function me bhi Firebase stats call karenge
window.onload = function() {
    const savedKey = localStorage.getItem('pro_active_key');
    const savedKeyData = localStorage.getItem('pro_key_data');
    
    if (savedKey && savedKeyData) {
        const keyData = JSON.parse(savedKeyData);
        
        // Check if key is still valid
        if (Date.now() < keyData.expiresAt) {
            // Verify with Firebase
            database.ref('keys/' + savedKey).once('value')
                .then(snapshot => {
                    const firebaseKeyData = snapshot.val();
                    if (firebaseKeyData && 
                        firebaseKeyData.isActive && 
                        firebaseKeyData.devices && 
                        firebaseKeyData.devices[currentDeviceId]) {
                        
                        currentKeyData = firebaseKeyData;
                        selectedPlatform = localStorage.getItem('selected_platform') || 'PRO PREDICTOR';
                        document.getElementById('selected-platform').textContent = selectedPlatform;
                        startCountdown();
                        document.getElementById('landing-page').style.display = 'none';
                        document.getElementById('prediction-page').style.display = 'block';
                        startPredictor();
                        loadHistoryFromFirebase();
                    }
                });
        } else {
            localStorage.removeItem('pro_active_key');
            localStorage.removeItem('pro_key_data');
        }
    }
};

async function verifyKey() {
    const keyInput = document.getElementById('key-input').value.trim().toUpperCase();
    const errorMsg = document.getElementById('error-msg');
    
    if (!keyInput) {
        errorMsg.innerText = 'Please enter a valid access key';
        errorMsg.style.display = 'block';
        return;
    }
    
    errorMsg.style.display = 'none';
    
    // Show loading state
    const verifyBtn = document.querySelector('.verify-btn');
    verifyBtn.innerHTML = '<div class="loading"></div> Verifying...';
    verifyBtn.disabled = true;
    
    try {
        const snapshot = await database.ref('keys/' + keyInput).once('value');
        const keyData = snapshot.val();
        
        if (!keyData || !keyData.isActive) {
            errorMsg.innerText = 'INVALID OR INACTIVE ACCESS KEY';
            errorMsg.style.display = 'block';
            shakeKeyContainer();
            return;
        }
        
        // Check if key is expired
        if (Date.now() > keyData.expiresAt) {
            errorMsg.innerText = 'ACCESS KEY HAS EXPIRED';
            errorMsg.style.display = 'block';
            shakeKeyContainer();
            return;
        }
        
        // Check device limit
        const deviceCount = keyData.devices ? Object.keys(keyData.devices).length : 0;
        if (deviceCount >= keyData.deviceLimit) {
            // Check if this device is already registered
            if (!keyData.devices || !keyData.devices[currentDeviceId]) {
                errorMsg.innerText = 'DEVICE LIMIT REACHED';
                errorMsg.style.display = 'block';
                shakeKeyContainer();
                return;
            }
        }
        
        // Register device if not already registered
        if (!keyData.devices || !keyData.devices[currentDeviceId]) {
            await database.ref('keys/' + keyInput + '/devices/' + currentDeviceId).set({
                registeredAt: Date.now(),
                lastUsed: Date.now(),
                platform: selectedPlatform
            });
        } else {
            // Update last used time
            await database.ref('keys/' + keyInput + '/devices/' + currentDeviceId + '/lastUsed').set(Date.now());
        }
        
        // Success - save key data
        currentKeyData = keyData;
        localStorage.setItem('pro_active_key', keyInput);
        localStorage.setItem('pro_key_data', JSON.stringify(keyData));
        localStorage.setItem('selected_platform', selectedPlatform);
        
        // Update UI
        document.getElementById('selected-platform').textContent = selectedPlatform;
        document.getElementById('key-page').style.display = 'none';
        document.getElementById('prediction-page').style.display = 'block';
        document.getElementById('nav-back').style.display = 'flex';
        
        // Start countdown
        startCountdown();
        
        // Start predictor and load history
        startPredictor();
        loadHistoryFromFirebase();
        
    } catch (error) {
        console.error('Key verification error:', error);
        errorMsg.innerText = 'NETWORK ERROR! PLEASE TRY AGAIN.';
        errorMsg.style.display = 'block';
        shakeKeyContainer();
    } finally {
        verifyBtn.innerHTML = '<i class="fas fa-unlock"></i> Verify & Continue';
        verifyBtn.disabled = false;
    }
}

    function shakeKeyContainer() {
        const keyContainer = document.querySelector('.auth-container');
        keyContainer.style.animation = 'shake 0.5s';
        setTimeout(() => {
            keyContainer.style.animation = '';
        }, 500);
    }

    // Add CSS for shake animation
    const style = document.createElement('style');
    style.innerHTML = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    `;
    document.head.appendChild(style);

    function goBack() {
        document.getElementById('key-page').style.display = 'none';
        document.getElementById('prediction-page').style.display = 'none';
        document.getElementById('landing-page').style.display = 'flex';
        document.getElementById('error-msg').style.display = 'none';
        document.getElementById('key-input').value = '';
        document.getElementById('nav-back').style.display = 'none';
        stopCountdown();
    }

    function goToLanding() {
        document.getElementById('prediction-page').style.display = 'none';
        document.getElementById('landing-page').style.display = 'flex';
        document.getElementById('nav-back').style.display = 'none';
        stopCountdown();
    }

    function openKeyPage(platform) {
        document.getElementById('selected-platform').textContent = platform;
        document.getElementById('landing-page').style.display = 'none';
        document.getElementById('key-page').style.display = 'flex';
        document.getElementById('error-msg').style.display = 'none';
        document.getElementById('key-input').focus();
    }

    function toggleAnalysis() {
        const content = document.getElementById('analysis-content');
        const toggleBtn = document.querySelector('.toggle-btn');
        
        if (content.style.display === 'none') {
            content.style.display = 'block';
            toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i> <span>Hide Analysis</span>';
        } else {
            content.style.display = 'none';
            toggleBtn.innerHTML = '<i class="fas fa-eye"></i> <span>Show Analysis</span>';
        }
    }

async function startPredictor() {
    document.getElementById('analysis-status').innerHTML = '<i class="fas fa-circle" style="font-size: 8px; color: var(--warning);"></i> <span>Analyzing...</span>';
    
    // Pehle Firebase se stats load karenge
    await updateStatsFromFirebase();
    
    await updateData(true);
    setInterval(() => updateData(false), 3000);
}

    async function updateData(isInitial = false) {
        if (isAnalyzing && !isInitial) return;
        
        try {
            const response = await fetch(API_URL);
            const json = await response.json();
            const list = json.data.list;
            const latestItem = list[0];
            const nextPeriod = (BigInt(latestItem.issueNumber) + 1n).toString();
            
            updateLast10Results(list.slice(0, 10));
            processPendingResults(list);
            
            if (nextPeriod !== lastPeriod) {
                lastPeriod = nextPeriod;
                document.getElementById('current-period').textContent = nextPeriod;
                
                if (!analysisComplete) {
                    document.getElementById('analysis-status').innerHTML = '<i class="fas fa-circle" style="font-size: 8px; color: var(--info);"></i> <span>Deep Analysis</span>';
                    
                    isAnalyzing = true;
                    setTimeout(() => {
                        performDeepAnalysis(list);
                        isAnalyzing = false;
                        analysisComplete = true;
                    }, 1500);
                } else {
                    document.getElementById('analysis-status').innerHTML = '<i class="fas fa-circle" style="font-size: 8px; color: var(--success);"></i> <span>Updating</span>';
                    quickUpdateAnalysis(list);
                }
            }
        } catch (e) { 
            console.error("Update Error", e);
            document.getElementById('analysis-status').innerHTML = '<i class="fas fa-circle" style="font-size: 8px; color: var(--danger);"></i> <span>Connection Error</span>';
        }
    }

    function updateLast10Results(data) {
        last10Results = data.map(item => {
            const num = parseInt(item.number);
            const size = num >= 5 ? "BIG" : "SMALL";
            let color;
            if (num === 0 || num === 5) {
                color = "VIOLET";
            } else {
                color = (num % 2 === 0) ? "RED" : "GREEN";
            }
            return {
                period: item.issueNumber,
                number: item.number,
                size: size,
                color: color
            };
        });
        
        updatePatternDisplay();
        updateDetailedAnalysis();
    }

    function performDeepAnalysis(list) {
        const sizeData = last10Results.map(r => r.size);
        const colorData = last10Results.map(r => r.color);
        const numbers = last10Results.map(r => parseInt(r.number));
        
        const sizePattern = detectPattern(sizeData, ['BIG', 'SMALL']);
        const colorPattern = detectPattern(colorData, ['RED', 'GREEN', 'VIOLET']);
        const numberPattern = detectNumberPattern(numbers);
        
        const bigCount = sizeData.filter(s => s === 'BIG').length;
        const smallCount = sizeData.filter(s => s === 'SMALL').length;
        const redCount = colorData.filter(c => c === 'RED').length;
        const greenCount = colorData.filter(c => c === 'GREEN').length;
        
        document.getElementById('big-percent').textContent = `${Math.round((bigCount/10)*100)}%`;
        document.getElementById('small-percent').textContent = `${Math.round((smallCount/10)*100)}%`;
        document.getElementById('red-percent').textContent = `${Math.round((redCount/10)*100)}%`;
        document.getElementById('green-percent').textContent = `${Math.round((greenCount/10)*100)}%`;
        
        currentAlgorithm = detectAlgorithm(sizePattern, colorPattern, numberPattern);
        document.getElementById('algo-name').textContent = currentAlgorithm.name;
        document.getElementById('algo-status').textContent = sizePattern.name + ' pattern detected';
        
        const actualPrediction = calculatePrediction(sizePattern, colorPattern, currentAlgorithm);
        realPrediction = actualPrediction;
        const displayPrediction = createOppositePrediction(actualPrediction);
        
        applyPredictionUI(displayPrediction, actualPrediction);
        
        // LOCAL history me add karenge, Firebase me PENDING status me save nahi karenge
        addToHistory(lastPeriod, actualPrediction, displayPrediction);
        
        document.getElementById('analysis-status').innerHTML = '<i class="fas fa-circle" style="font-size: 8px; color: var(--success);"></i> <span>Algorithm Active</span>';
        document.getElementById('algo-confidence').textContent = actualPrediction.confidence + '%';
        
        updateStats();
    }

    function createOppositePrediction(prediction) {
        let oppositeValue = prediction.value;
        let oppositeType = prediction.type;
        
        if (prediction.type === 'SIZE') {
            oppositeValue = (prediction.value === 'BIG') ? 'SMALL' : 'BIG';
        } else if (prediction.type === 'COLOR') {
            if (prediction.value === 'RED') {
                oppositeValue = 'GREEN';
            } else if (prediction.value === 'GREEN') {
                oppositeValue = 'RED';
            } else if (prediction.value === 'VIOLET') {
                oppositeValue = (Math.random() > 0.5) ? 'RED' : 'GREEN';
            }
        }
        
        return {
            type: oppositeType,
            value: oppositeValue,
            confidence: prediction.confidence,
            algorithm: prediction.algorithm,
            isOpposite: true
        };
    }

    function quickUpdateAnalysis(list) {
        const sizeData = last10Results.map(r => r.size);
        const colorData = last10Results.map(r => r.color);
        
        const sizePattern = detectPattern(sizeData, ['BIG', 'SMALL']);
        const colorPattern = detectPattern(colorData, ['RED', 'GREEN', 'VIOLET']);
        
        if (sizePattern.count < 3 || colorPattern.count < 2) {
            setTimeout(() => performDeepAnalysis(list), 1000);
            return;
        }
        
        const numbers = last10Results.map(r => parseInt(r.number));
        const numberPattern = detectNumberPattern(numbers);
        const actualPrediction = calculatePrediction(sizePattern, colorPattern, currentAlgorithm);
        
        realPrediction = actualPrediction;
        const displayPrediction = createOppositePrediction(actualPrediction);
        
        applyPredictionUI(displayPrediction, actualPrediction);
        
        // LOCAL history me add karenge
        addToHistory(lastPeriod, actualPrediction, displayPrediction);
    }

    function detectPattern(data, types) {
        let currentStreak = 1;
        for (let i = 1; i < data.length; i++) {
            if (data[i] === data[i-1]) currentStreak++;
            else break;
        }
        
        let alternating = true;
        for (let i = 2; i < data.length; i++) {
            if (data[i] !== data[i-2]) {
                alternating = false;
                break;
            }
        }
        
        const typeCounts = {};
        types.forEach(type => {
            typeCounts[type] = data.filter(d => d === type).length;
        });
        
        const dominantType = Object.keys(typeCounts).reduce((a, b) => 
            typeCounts[a] > typeCounts[b] ? a : b
        );
        
        if (currentStreak >= 3) {
            return { name: `${dominantType} STREAK`, count: currentStreak, type: 'streak', dominant: dominantType };
        } else if (alternating && data.length >= 3) {
            return { name: `ALTERNATING`, count: Math.floor(data.length/2), type: 'alternating' };
        } else if (typeCounts[dominantType] >= 7) {
            return { name: `${dominantType} DOMINANT`, count: typeCounts[dominantType], type: 'dominant', dominant: dominantType };
        } else {
            return { name: `RANDOM PATTERN`, count: 0, type: 'random' };
        }
    }

    function detectNumberPattern(numbers) {
        const bigNumbers = numbers.filter(n => n >= 5).length;
        const smallNumbers = numbers.filter(n => n < 5).length;
        const evenNumbers = numbers.filter(n => n % 2 === 0).length;
        const oddNumbers = numbers.filter(n => n % 2 === 1).length;
        const violetNumbers = numbers.filter(n => n === 0 || n === 5).length;
        
        const avg = numbers.reduce((a, b) => a + b, 0) / numbers.length;
        
        return {
            bigCount: bigNumbers,
            smallCount: smallNumbers,
            evenCount: evenNumbers,
            oddCount: oddNumbers,
            violetCount: violetNumbers,
            average: avg
        };
    }

    function detectAlgorithm(sizePattern, colorPattern, numberPattern) {
        const algorithms = [
            { name: "MEAN REVERSION", confidence: 0 },
            { name: "TREND FOLLOWING", confidence: 0 },
            { name: "PATTERN BREAK", confidence: 0 },
            { name: "MOMENTUM", confidence: 0 },
            { name: "COUNTER-TREND", confidence: 0 }
        ];
        
        if (sizePattern.type === 'streak' && sizePattern.count >= 3) {
            algorithms[0].confidence += 30;
            algorithms[4].confidence += 20;
        }
        
        if (sizePattern.type === 'dominant') {
            algorithms[1].confidence += 25;
            algorithms[3].confidence += 20;
        }
        
        if (colorPattern.type === 'alternating') {
            algorithms[2].confidence += 35;
        }
        
        if (numberPattern.violetCount >= 2) {
            algorithms[2].confidence += 20;
        }
        
        const bestAlgo = algorithms.reduce((a, b) => 
            a.confidence > b.confidence ? a : b
        );
        
        return bestAlgo;
    }

    function calculatePrediction(sizePattern, colorPattern, algorithm) {
        let type, value, confidence;
        const sizeData = last10Results.map(r => r.size);
        const colorData = last10Results.map(r => r.color);
        
        const bigCount = sizeData.filter(s => s === 'BIG').length;
        const smallCount = sizeData.filter(s => s === 'SMALL').length;
        const redCount = colorData.filter(c => c === 'RED').length;
        const greenCount = colorData.filter(c => c === 'GREEN').length;
        
        const bigProb = bigCount / 10;
        const smallProb = smallCount / 10;
        const redProb = redCount / 10;
        const greenProb = greenCount / 10;
        
        switch(algorithm.name) {
            case "MEAN REVERSION":
                if (sizePattern.type === 'streak' && sizePattern.dominant) {
                    type = 'SIZE';
                    value = sizePattern.dominant === 'BIG' ? 'SMALL' : 'BIG';
                    confidence = 75 + Math.floor(Math.random() * 15);
                } else {
                    type = bigProb > smallProb ? 'SIZE' : 'COLOR';
                    value = type === 'SIZE' ? 
                        (bigProb > 0.7 ? 'SMALL' : 'BIG') : 
                        (redProb > 0.7 ? 'GREEN' : 'RED');
                    confidence = 70 + Math.floor(Math.random() * 20);
                }
                break;
                
            case "TREND FOLLOWING":
                type = Math.abs(bigProb - 0.5) > Math.abs(redProb - 0.5) ? 'SIZE' : 'COLOR';
                if (type === 'SIZE') {
                    value = bigProb > 0.5 ? 'BIG' : 'SMALL';
                } else {
                    value = redProb > 0.5 ? 'RED' : 'GREEN';
                }
                confidence = 65 + Math.floor(Math.random() * 25);
                break;
                
            case "PATTERN BREAK":
                const lastTwoSizes = sizeData.slice(0, 2);
                const lastTwoColors = colorData.slice(0, 2);
                
                if (lastTwoSizes[0] === lastTwoSizes[1]) {
                    type = 'SIZE';
                    value = lastTwoSizes[0] === 'BIG' ? 'SMALL' : 'BIG';
                } else if (lastTwoColors[0] === lastTwoColors[1]) {
                    type = 'COLOR';
                    value = lastTwoColors[0] === 'RED' ? 'GREEN' : 'RED';
                } else {
                    type = 'SIZE';
                    value = Math.random() > 0.5 ? 'BIG' : 'SMALL';
                }
                confidence = 68 + Math.floor(Math.random() * 22);
                break;
                
            default:
                const maxProb = Math.max(bigProb, smallProb, redProb, greenProb);
                if (maxProb === bigProb || maxProb === smallProb) {
                    type = 'SIZE';
                    value = bigProb > smallProb ? 'BIG' : 'SMALL';
                } else {
                    type = 'COLOR';
                    value = redProb > greenProb ? 'RED' : 'GREEN';
                }
                confidence = 60 + Math.floor(Math.random() * 30);
        }
        
        return { type: type, value: value, confidence: confidence, algorithm: algorithm.name };
    }

    function applyPredictionUI(displayPred, realPred) {
        const txt = document.getElementById('prediction-text');
        txt.textContent = displayPred.value;
        
        // Update text color based on prediction type
        if (displayPred.value === 'BIG' || displayPred.value === 'SMALL') {
            txt.style.color = displayPred.value === 'BIG' ? 'var(--success)' : 'var(--info)';
        } else {
            txt.style.color = displayPred.value === 'RED' ? 'var(--danger)' : 'var(--success)';
        }

        document.getElementById('confidence-display').textContent = displayPred.confidence + '%';
        document.getElementById('confidence-fill').style.width = displayPred.confidence + "%";
        document.getElementById('prediction-type').textContent = 
            `${displayPred.type} Prediction • ${displayPred.algorithm}`;
        
        document.getElementById('algo-confidence').textContent = displayPred.confidence + '%';
    }

    function updatePatternDisplay() {
        const container = document.getElementById('pattern-display');
        container.innerHTML = "";
        last10Results.forEach(item => {
            const div = document.createElement('div');
            div.className = `pattern-item ${item.size.toLowerCase()}`;
            div.textContent = item.number;
            container.appendChild(div);
        });
    }

    function updateDetailedAnalysis() {
        // Could add more detailed analysis here if needed
    }

function processPendingResults(list) {
    if (historyData.length > 0) {
        historyData.forEach(item => {
            if (item.status === 'PENDING') {
                const match = list.find(l => l.issueNumber === item.period);
                if (match) {
                    const num = parseInt(match.number);
                    const realSize = num >= 5 ? "BIG" : "SMALL";
                    let realColor;
                    if (num === 0 || num === 5) {
                        realColor = "VIOLET";
                    } else {
                        realColor = (num % 2 === 0) ? "RED" : "GREEN";
                    }
                    
                    let isWin = false;
                    if(item.displayType === 'SIZE' && item.displayValue === realSize) isWin = true;
                    if(item.displayType === 'COLOR' && item.displayValue === realColor) isWin = true;
                    
                    item.status = isWin ? 'WIN' : 'LOSS';
                    item.realValue = `${match.number} (${realSize}/${realColor})`;
                    
                    // WIN/LOSS ho gaya to Firebase me save karenge
                    savePredictionToFirebase(item);
                    
                    // Ab statistics Firebase se update karenge
                    updateStatsFromFirebase();
                    
                    // Local history render karenge
                    renderLocalHistory();
                }
            }
        });
    }
}

// Save prediction to Firebase function
function savePredictionToFirebase(prediction) {
    const predictionId = 'pred_' + Date.now();
    const predictionData = {
        period: prediction.period,
        type: prediction.type,
        value: prediction.value,
        displayValue: prediction.displayValue,
        algorithm: prediction.algorithm,
        confidence: prediction.confidence,
        createdAt: Date.now(),
        status: prediction.status, // WIN ya LOSS
        realResult: prediction.realValue || '',
        platform: selectedPlatform,
        isActive: true
    };
    
    database.ref('predictions/' + predictionId).set(predictionData)
        .then(() => {
            console.log('Prediction saved to Firebase:', predictionId, 'Status:', prediction.status);
            // Firebase history refresh karenge
            loadHistoryFromFirebase();
        })
        .catch(error => {
            console.error('Error saving prediction to Firebase:', error);
        });
}

function updateStats() {
    // Ab ye function Firebase se data lega
    updateStatsFromFirebase();
}

    function addToHistory(period, actualPred, displayPred) {
        historyData.unshift({ 
            period: period, 
            type: actualPred.type,
            value: actualPred.value,
            displayType: displayPred.type,
            displayValue: displayPred.value,
            algorithm: actualPred.algorithm,
            status: 'PENDING',
            confidence: actualPred.confidence
        });
        
        if(historyData.length > 10) historyData.pop();
        renderLocalHistory();
    }

    // Firebase History Functions
    async function loadHistoryFromFirebase() {
        try {
            const snapshot = await database.ref('predictions').orderByChild('createdAt').once('value');
            const predictions = snapshot.val();
            
            if (!predictions) {
                document.getElementById('history-list').innerHTML = 
                    '<div style="color: var(--text-gray); text-align: center; padding: 40px;">No prediction history available.</div>';
                return;
            }
            
            allFirebasePredictions = Object.keys(predictions).map(predId => {
                return { id: predId, ...predictions[predId] };
            });
            
            // Sort by creation date (newest first)
            allFirebasePredictions.sort((a, b) => b.createdAt - a.createdAt);
            
            // Apply filter
            const filter = document.getElementById('history-filter').value;
            let filteredPredictions = allFirebasePredictions;
            
            if (filter !== 'all') {
                filteredPredictions = allFirebasePredictions.filter(pred => {
                    if (filter === 'win') return pred.status === 'WIN';
                    if (filter === 'loss') return pred.status === 'LOSS';
                    if (filter === 'pending') return pred.status === 'PENDING';
                    return true;
                });
            }
            
            // Calculate pagination
            totalHistoryPages = Math.ceil(filteredPredictions.length / HISTORY_PAGE_SIZE);
            if (totalHistoryPages === 0) totalHistoryPages = 1;
            
            if (currentHistoryPage > totalHistoryPages) {
                currentHistoryPage = totalHistoryPages;
            }
            
            document.getElementById('current-page').textContent = currentHistoryPage;
            document.getElementById('total-pages').textContent = totalHistoryPages;
            
            // Get current page data
            const startIndex = (currentHistoryPage - 1) * HISTORY_PAGE_SIZE;
            const endIndex = startIndex + HISTORY_PAGE_SIZE;
            const pagePredictions = filteredPredictions.slice(startIndex, endIndex);
            
            renderFirebaseHistory(pagePredictions);
            renderPagination();
            
        } catch (error) {
            console.error('Error loading history from Firebase:', error);
            document.getElementById('history-list').innerHTML = 
                '<div style="color: var(--danger); text-align: center; padding: 30px;">Error loading history: ' + error.message + '</div>';
        }
    }
    
    function renderFirebaseHistory(predictions) {
        const container = document.getElementById('history-list');
        
        if (predictions.length === 0) {
            container.innerHTML = '<div style="color: var(--text-gray); text-align: center; padding: 40px;">No predictions match your filter.</div>';
            return;
        }
        
        container.innerHTML = "";
        
        predictions.forEach(prediction => {
            const div = document.createElement('div');
            div.className = 'history-item';
            
            const createdDate = new Date(prediction.createdAt);
            const statusClass = prediction.status.toLowerCase();
            const statusColor = prediction.status === 'WIN' ? 'var(--success)' : 
                              prediction.status === 'LOSS' ? 'var(--danger)' : 'var(--warning)';
            
            div.innerHTML = `
                <div>
                    <div class="history-period">Period: ${prediction.period}</div>
                    <div style="font-size: 12px; color: var(--text-light);">
                        ${createdDate.toLocaleDateString()} ${createdDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                    </div>
                </div>
                <div style="text-align: center;">
                    <div style="font-weight: 700; font-size: 20px; color: ${statusColor}">
                        ${prediction.displayValue || prediction.value}
                    </div>
                    <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">
                        ${prediction.type} • ${prediction.algorithm}
                    </div>
                </div>
                <div>
                    <div class="history-status status-${statusClass}">
                        ${prediction.status}
                    </div>
                    <div style="font-size: 12px; color: var(--text-gray); text-align: center; margin-top: 4px;">
                        ${prediction.confidence}% conf
                    </div>
                </div>
            `;
            
            container.appendChild(div);
        });
    }
    
    function renderPagination() {
        const container = document.getElementById('pagination-controls');
        
        if (totalHistoryPages <= 1) {
            container.innerHTML = '';
            return;
        }
        
        let paginationHTML = '';
        
        // Previous button
        if (currentHistoryPage > 1) {
            paginationHTML += `<button class="page-btn" onclick="changeHistoryPage(${currentHistoryPage - 1})"><i class="fas fa-chevron-left"></i></button>`;
        }
        
        // Page numbers
        const maxPagesToShow = 5;
        let startPage = Math.max(1, currentHistoryPage - Math.floor(maxPagesToShow / 2));
        let endPage = Math.min(totalHistoryPages, startPage + maxPagesToShow - 1);
        
        if (endPage - startPage + 1 < maxPagesToShow) {
            startPage = Math.max(1, endPage - maxPagesToShow + 1);
        }
        
        for (let i = startPage; i <= endPage; i++) {
            if (i === currentHistoryPage) {
                paginationHTML += `<button class="page-btn active">${i}</button>`;
            } else {
                paginationHTML += `<button class="page-btn" onclick="changeHistoryPage(${i})">${i}</button>`;
            }
        }
        
        // Next button
        if (currentHistoryPage < totalHistoryPages) {
            paginationHTML += `<button class="page-btn" onclick="changeHistoryPage(${currentHistoryPage + 1})"><i class="fas fa-chevron-right"></i></button>`;
        }
        
        container.innerHTML = paginationHTML;
    }
    
    function changeHistoryPage(page) {
        if (page < 1 || page > totalHistoryPages) return;
        
        currentHistoryPage = page;
        loadHistoryFromFirebase();
    }
    
    // Local history render function (for PENDING predictions only)
    function renderLocalHistory() {
        const container = document.getElementById('history-list');
        
        // Agar Firebase se data load ho raha hai to local history show nahi karenge
        if (allFirebasePredictions && allFirebasePredictions.length > 0) {
            return;
        }
        
        // Agar Firebase me data nahi hai, tabhi local history show karenge
        container.innerHTML = "";
        historyData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'history-item';
            
            const statusClass = item.status.toLowerCase();
            const statusColor = item.status === 'WIN' ? 'var(--success)' : 
                              item.status === 'LOSS' ? 'var(--danger)' : 'var(--warning)';
            
            div.innerHTML = `
                <div>
                    <div class="history-period">#${item.period.slice(-4)}</div>
                    <div style="font-size: 12px; color: var(--text-light);">${item.algorithm}</div>
                </div>
                <div style="font-weight: 700; font-size: 20px; color: ${statusColor}">
                    ${item.displayValue}
                </div>
                <div class="history-status status-${statusClass}">
                    ${item.status}
                </div>
            `;
            container.appendChild(div);
        });
    }
    
    // Enter key support for password input
    document.getElementById('key-input').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            verifyKey();
        }
    });
    
    // Initialize on page load
    window.onload();
</script>
</body>
</html>